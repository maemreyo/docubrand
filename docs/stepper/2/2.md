## Project Context and Current State for DocuBrand - PDFme Integration

This document provides a comprehensive overview of the current state of the DocuBrand project, specifically focusing on the PDFme integration and educational template system. This context is crucial for continuing development, as the previous chat session may have lost its state.

**Project Goal:**
The primary objective is to build a robust PDF generation and template management system using `pdfme` for educational documents. This involves integrating `pdfme` with our existing `Gemini` analysis capabilities to dynamically generate PDF templates and documents.

**Key Implementations Completed:**

1.  **Core PDFme Integration (`src/lib/pdfme-integration.ts`)**:
    *   This file contains the central `PdfmeIntegration` class, which acts as a wrapper for `pdfme` functionalities.
    *   It handles:
        *   Initialization of `pdfme` Designer, Form, and Viewer instances.
        *   PDF generation (`generatePDF` method).
        *   Template validation (`validateTemplate` method).
        *   Management of `pdfme` plugins and fonts.
        *   Utilities for creating blank and educational-specific templates.
        *   Helper methods for downloading templates and generated PDFs.
    *   **Key Types/Concepts:** `Template`, `Schema`, `Font`, `ValidationResult`, `GenerationOptions`.

2.  **Gemini to PDFme Mapping (`src/lib/gemini-to-pdfme.ts`)**:
    *   This file defines the `GeminiToPdfmeMapper` class, responsible for converting `GeminiAnalysisResponse` (from our AI analysis) into `pdfme` `Template` objects.
    *   It intelligently maps extracted content (titles, sections, questions) into `pdfme` schemas, handling layout, positioning, and styling based on a configurable `MappingConfig`.
    *   **Key Types/Concepts:** `GeminiAnalysisResponse`, `MappingConfig`, `DataBinding`, `MappingResult`.

3.  **Template Manager (`src/lib/template-manager.ts`)**:
    *   This file implements a comprehensive `TemplateManager` class for CRUD (Create, Read, Update, Delete) operations on `pdfme` templates.
    *   It uses `localStorage` for persistence (via `LocalTemplateStorage`).
    *   Supports creating templates from scratch or from `Gemini` analysis.
    *   Includes functionalities for listing, searching, duplicating, importing, and exporting templates.
    *   **Key Types/Concepts:** `TemplateMetadata`, `TemplateDefinition`, `TemplateStorage`.

4.  **Educational PDFme Plugins (`src/lib/educational-plugins.ts`)**:
    *   This file defines custom `pdfme` plugins tailored for educational content.
    *   Implemented plugins include: `multipleChoicePlugin`, `trueFalsePlugin`, `shortAnswerPlugin`, `essayPlugin`, and `instructionBoxPlugin`.
    *   These plugins extend `pdfme`'s capabilities to render specific educational elements and provide custom UI for the designer.
    *   **Key Types/Concepts:** `Plugin`, `MultipleChoiceSchema`, `TrueFalseSchema`, etc.

5.  **Extended Type Definitions (`src/types/pdfme-extensions.ts`)**:
    *   This file contains custom TypeScript interfaces and types that extend `pdfme`'s core types (`Schema`, `Template`, `Plugin`) to include educational-specific properties and metadata.
    *   It defines `EducationalSchema`, `EducationalTemplate`, `EducationalPlugin`, and various interfaces for data binding, validation, scoring, and template configuration.
    *   **Key Types/Concepts:** `EducationalSchemaType`, `EducationalSchema`, `EducationalTemplate`, `RubricCriteria`, `TemplateGenerationOptions`.

6.  **Basic Template Definitions (`src/templates/basic-templates.ts`)**:
    *   This file provides pre-defined `EducationalTemplate` objects for common educational document types.
    *   Includes `basicTemplate`, `quizTemplate`, `worksheetTemplate`, `examTemplate`, and `assignmentTemplate`.
    *   These serve as starting points for users and demonstrate how to structure educational templates.

7.  **UI Components**:
    *   **`src/components/TemplateDesigner.tsx`**: A React component that wraps the `pdfme` Designer UI. It integrates the educational block library and provides a user interface for template creation and editing.
    *   **`src/components/TemplatePreview.tsx`**: A React component for previewing `pdfme` templates. It can display templates in both viewer and form modes, allows for data input, and handles PDF generation/download.
    *   **`src/components/PDFmeTest.tsx`**: A dedicated test component for verifying the core `pdfme` integration and educational plugins. It demonstrates how to initialize the designer and viewer, and generate PDFs.

**Project Plan and Progress Tracking:**
The detailed project plan and progress are tracked in `docs/PDFme_impl_todo.md`. This file outlines tasks, their status (completed, in progress, etc.), and dependencies. It also contains the overall roadmap for the template system.

**Dependencies:**
The project uses `@pdfme/common`, `@pdfme/generator`, `@pdfme/schemas`, and `@pdfme/ui` as core `pdfme` dependencies, as listed in `package.json`.

**Next Steps (as per `docs/PDFme_impl_todo.md`):**
The immediate next steps involve completing the `Data Binding System` (Task T4) and the remaining `UI Components` (`BlockLibrary.tsx`, `TemplateManager.tsx`).

Please review the mentioned files and the `docs/PDFme_impl_todo.md` to get a full understanding of the project's current state and planned work.
